<%# ================== SEO (head) ================== %>
<% content_for :title,            @page_title %>
<% content_for :meta_description, @page_description %>
<% content_for :og_title,         @page_title %>
<% content_for :og_description,   @page_description %>

<% content_for :structured_data do %>
  <script type="application/ld+json" nonce="<%= content_security_policy_nonce %>">
    <%= [
      {
        "@context": "https://schema.org",
        "@type": "CreativeWork",
        "name": @project.title,
        "description": @page_description,
        "url": project_url(@project),
        "image": (@og_image.present? ? image_url(@og_image) : image_url("og/default.jpg")),
        "author": { "@type": "Person", "name": "Sami Chabane", "url": "https://samichabane.com" },
        "keywords": @project.techs.to_s.split(",").map(&:strip).join(", ")
      },
      {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Accueil",  "item": root_url },
          { "@type": "ListItem", "position": 2, "name": "Projets",  "item": root_url(anchor: "projects") },
          { "@type": "ListItem", "position": 3, "name": @project.title, "item": project_url(@project) }
        ]
      }
    ].to_json.html_safe %>
  </script>
<% end %>

<%# ================== PAGE ================== %>
<%
  c1, c2, c3 = project_theme_colors(@project)
  c1 ||= '#0ea5e9'; c2 ||= '#6366f1'; c3 ||= '#a78bfa'
%>

<section class="max-w-6xl mx-auto px-4 sm:px-6 py-10" style="--c1:<%= c1 %>; --c2:<%= c2 %>; --c3:<%= c3 %>;">
  <%= link_to "‚Üê Retour", projects_path, class: "hover:underline", style: "color: #{c2};" %>

  <!-- En-t√™te / Hero -->
  <header class="mt-4 flex flex-col gap-4 md:flex-row md:items-end md:justify-between">
    <div>
      <%# TITRE TOUJOURS LISIBLE : noir fixe %>
      <h1 class="text-4xl md:text-5xl font-black tracking-tight text-slate-900">
        <%= @project.title %>
      </h1>
      <%# petite barre d√©grad√©e sous le titre %>
      <div style="height:6px;border-radius:999px;margin-top:8px;background:linear-gradient(90deg,<%= c1 %>,<%= c2 %>,<%= c3 %>);"></div>

      <% if @project.subtitle.present? %>
        <p class="mt-3 text-lg text-slate-600"><%= @project.subtitle %></p>
      <% end %>
    </div>

    <div class="flex gap-3">
      <% if @project.url.present? %>
        <%= link_to "Voir le site", @project.url, target: "_blank", rel: "noopener",
            class: "inline-flex items-center gap-2 rounded-xl px-4 py-2.5 text-white font-semibold shadow transition",
            style: "background-color: #{c2};" %>
      <% end %>
      <% if @project.respond_to?(:repo_url) && @project.repo_url.present? %>
        <%= link_to "Voir le code", @project.repo_url, target: "_blank", rel: "noopener",
            class: "inline-flex items-center gap-2 rounded-xl px-4 py-2.5 text-white font-semibold shadow transition",
            style: "background-color: #111827;" %>
      <% end %>
    </div>
  </header>

  <!-- Visuel de couverture -->
  <div class="mt-6 overflow-hidden rounded-2xl ring-1 ring-slate-200 bg-slate-50">
    <img src="<%= project_image_src(@project) %>" alt="<%= @project.title %>"
         width="1280" height="720" class="w-full h-auto object-cover">
  </div>

  <!-- Fiche projet -->
  <section class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
    <div class="rounded-2xl ring-1 ring-slate-200 bg-white p-4">
      <p class="text-sm text-slate-500">R√¥le</p>
      <p class="mt-1 font-semibold text-slate-900">D√©veloppeur full-stack</p>
    </div>
    <div class="rounded-2xl ring-1 ring-slate-200 bg-white p-4">
      <p class="text-sm text-slate-500">Dur√©e</p>
      <p class="mt-1 font-semibold text-slate-900">2 semaines</p>
    </div>
    <div class="rounded-2xl ring-1 ring-slate-200 bg-white p-4">
      <p class="text-sm text-slate-500">Statut</p>
      <% text, klass = project_status(@project) %>
      <p class="mt-1 font-semibold <%= klass %>"><%= text %></p>
    </div>
  </section>

  <!-- Description (toujours affich√©e) -->
<section class="mt-8">
  <h2 class="text-2xl font-bold tracking-tight">Description</h2>
  <div class="prose prose-slate max-w-none mt-4">
    <% desc = (@project.description.presence || project_description_fallback(@project)).to_s.strip %>
    <% desc = "Pr√©sentation du projet, objectifs, choix techniques et points forts UX/UI. Priorit√© √† la performance et au SEO de base." if desc.blank? %>
    <%= simple_format desc %>
  </div>
</section>



  <!-- Fonctionnalit√©s -->
  <% features = project_features(@project) %>
  <section class="mt-8">
    <h2 class="text-2xl font-bold tracking-tight">Fonctionnalit√©s cl√©s</h2>
    <ul class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3">
      <% features.each do |feat| %>
        <li class="rounded-xl ring-1 ring-slate-200 bg-white p-4"><%= feat %></li>
      <% end %>
    </ul>
  </section>

  <!-- Badges techno -->
  <div class="mt-6 flex flex-wrap items-center gap-3">
    <% @project.techs.to_s.split(",").map(&:strip).each do |t| %>
      <span class="inline-flex items-center rounded-full px-3 py-1 text-sm ring-1 bg-slate-100 text-slate-700 border border-slate-200">
        <%= t %>
      </span>
    <% end %>
  </div>

  <%# --------- CAROUSEL --------- %>
  <%
    base_images = project_image_list(@project).presence || [project_image_src(@project)]

    is_lorenzo = @project.slug.to_s.downcase.in?(%w[portfolio-comedien lorenzo-granjon site-lorenzo])
    is_psy     = @project.slug.to_s.downcase.include?("psy")

    extra_images =
      if is_lorenzo
        [
          image_path("projects/lorenzo/1.jpg"),
          image_path("projects/lorenzo/2.jpg"),
          image_path("projects/lorenzo/3.jpg"),
          image_path("projects/lorenzo/4.jpg")
        ]
      elsif is_psy
        [
          image_path("projects/site-psy/frederiquegranjonsite1.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite2.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite3.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite4.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite5.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite6.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite7.jpg"),
          image_path("projects/site-psy/frederiquegranjonsite8.jpg")
        ]
      else
        []
      end

    images = base_images + extra_images
  %>

  <div id="carousel-<%= @project.slug %>"
       class="relative w-full max-w-6xl mx-auto mt-8 select-none group"
       aria-roledescription="carousel"
       data-autoplay="true"
       data-interval="4000"
       data-pause-on-hover="true">
    <div class="relative h-72 sm:h-80 md:h-[28rem] lg:h-[34rem]
                overflow-hidden rounded-2xl ring-1 ring-slate-200 bg-white">
      <% images.each_with_index do |src, i| %>
        <img src="<%= src %>"
             alt="<%= @project.title %> ‚Äî visuel <%= i + 1 %> sur <%= images.size %>"
             class="carousel-slide <%= i.zero? ? '' : 'hidden' %>
                    w-full h-72 sm:h-80 md:h-[28rem] lg:h-[34rem]
                    object-contain mx-auto transition-transform duration-500 ease-out group-hover:scale-105"
             data-index="<%= i %>">
      <% end %>
    </div>
    <button type="button" class="absolute left-0 top-1/2 -translate-y-1/2 px-3 py-2 text-3xl"
            aria-label="Image pr√©c√©dente" data-action="prev">‚Äπ</button>
    <button type="button" class="absolute right-0 top-1/2 -translate-y-1/2 px-3 py-2 text-3xl"
            aria-label="Image suivante" data-action="next">‚Ä∫</button>
    <div class="mt-3 flex justify-center gap-2">
      <% images.each_with_index do |_, i| %>
        <button type="button"
                class="carousel-dot h-2.5 w-2.5 rounded-full <%= i.zero? ? 'bg-slate-900' : 'bg-slate-300' %>"
                aria-label="Aller √† l‚Äôimage <%= i + 1 %>" data-goto="<%= i %>"></button>
      <% end %>
    </div>
  </div>

  <!-- CTA -->
  <section class="mt-12">
    <div class="rounded-2xl ring-1 ring-slate-200 bg-slate-50 p-6 md:p-8">
      <h3 class="text-xl md:text-2xl font-bold" style="color:<%= c2 %>;">Un projet similaire en t√™te ?</h3>
      <p class="mt-2 text-slate-700">
        Je con√ßois des sites √©l√©gants, rapides et pens√©s pour la conversion. Parlons de votre besoin. üí¨
      </p>
      <%= link_to "Me contacter", root_path(anchor: "contact"),
  class: "mt-4 inline-flex items-center rounded-xl px-4 py-2.5 text-white font-semibold shadow transition
          bg-[#111827] hover:brightness-110 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-slate-400" %>



    </div>
  </section>
</section>
