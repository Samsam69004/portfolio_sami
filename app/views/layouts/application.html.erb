<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title><%= meta_title %></title>
  <meta name="description" content="<%= meta_description %>">
  <meta name="robots" content="<%= meta_robots %>">
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%# Google Search Console : une seule balise (ENV prioritaire, sinon valeur fixe) %>
  <% if Rails.env.production? && ENV["GSC_META"].present? %>
    <meta name="google-site-verification" content="<%= ENV["GSC_META"] %>">
  <% else %>
    <meta name="google-site-verification" content="k75yQfe4Kg3FGQ_hL7gDgmPXUtkIw7ynFTGrnrC--1I">
  <% end %>

  <!-- Canonical -->
  <link rel="canonical" href="<%= canonical_url %>">

  <!-- Open Graph -->
  <meta property="og:type" content="<%= content_for?(:og_type) ? yield(:og_type) : 'website' %>">
  <meta property="og:title" content="<%= meta_title %>">
  <meta property="og:description" content="<%= meta_description %>">
  <meta property="og:url" content="<%= canonical_url %>">
  <meta property="og:image" content="<%= meta_image %>">
  <meta property="og:site_name" content="Portfolio — Sami Chabane">
  <meta property="og:locale" content="fr_FR">

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="<%= meta_title %>">
  <meta name="twitter:description" content="<%= meta_description %>">
  <meta name="twitter:image" content="<%= meta_image %>">

  <!-- Favicons -->
  <link rel="icon" href="<%= image_path('favicons/favicon.ico') %>">
  <link rel="icon" type="image/png" sizes="96x96" href="<%= asset_path("favicons/favicon-96x96.png") %>">
  <link rel="apple-touch-icon" href="<%= asset_path("favicons/apple-touch-icon.png") %>">

  <!-- (perf) préconnect -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">

  <!-- Styles & JS -->
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%# AOS: on importe via npm/esbuild, donc pas de vendor/aos.css pour éviter 404 %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", defer: true, type: "module" %>

  <!-- Emplacement pour JSON-LD fourni par des vues/partials.
       ⚠️ Si tu mets du inline ici via content_for, assure-toi de lui ajouter un nonce. -->
  <%= yield(:structured_data) if content_for?(:structured_data) %>

  <!-- JSON-LD Person -->
  <script type="application/ld+json" nonce="<%= content_security_policy_nonce %>">
  {
    "@context": "https://schema.org",
    "@type": "Person",
    "name": "Sami Chabane",
    "url": "https://samichabane.com",
    "jobTitle": "Développeur web junior",
    "knowsAbout": ["Ruby on Rails", "HTML", "CSS", "Tailwind", "JavaScript"],
    "sameAs": [
      "https://github.com/Samsam69004",
      "https://www.linkedin.com/in/sami-chabane-085881151/"
    ]
  }
  </script>

  <!-- JSON-LD WebSite -->
  <script type="application/ld+json" nonce="<%= content_security_policy_nonce %>">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "Portfolio — Sami Chabane",
    "url": "https://samichabane.com",
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://samichabane.com/?q={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>

  <% if Rails.env.production? && ENV["HOTJAR_ID"].present? %>
    <!-- Hotjar -->
    <script nonce="<%= content_security_policy_nonce %>">
      (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:<%= ENV["HOTJAR_ID"] %>,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
      })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
    </script>
  <% end %>
</head>

<body class="bg-slate-50 text-slate-800">
  <header id="mainNav" data-shrink class="sticky top-0 z-50 bg-white/90 backdrop-blur border-b border-slate-200">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 flex items-center justify-between">

    <!-- Logo + Nom -->
    <%= link_to root_path, class: "flex items-center gap-3" do %>
      <!-- ton SVG logo inchangé -->
      <%= image_tag "projects/logo-sc-animated-diamond.svg",
              alt: "Logo SC", class: "h-8 w-8" %>
      <!-- ... -->
      <span class="text-xl font-bold tracking-tight">Sami Chabane</span>
    <% end %>

    <!-- Boutons à droite -->
    <div class="flex items-center gap-3">
      <!-- Bouton hamburger (mobile seulement) -->
      <button id="menuBtn"
              class="md:hidden inline-flex items-center justify-center rounded-xl border border-slate-300 p-2 hover:border-sky-600 hover:text-sky-600"
              aria-label="Ouvrir le menu" aria-expanded="false" aria-controls="mobileMenu">
        <!-- icône -->
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <!-- Bouton Discuter (toujours visible) -->
      <%= link_to "Discuter", root_path(anchor: "contact"), data: { turbo: false },
        class: "hidden sm:inline-flex items-center gap-2 rounded-xl bg-sky-500 px-4 py-2.5 text-lg font-semibold text-white shadow hover:bg-sky-600 transition md:inline-flex" %>
    </div>
  </div>

  <!-- Nav desktop -->
  <div class="max-w-6xl mx-auto px-4 sm:px-6">
    <nav class="hidden md:flex gap-8 text-lg font-semibold py-2">
      <%= link_to "Projets",        root_path(anchor: "projects"),        data: { turbo: false }, class: "hover:text-sky-600 transition" %>
      <%= link_to "Certifications", root_path(anchor: "certifications"),  data: { turbo: false }, class: "hover:text-sky-600 transition" %>
      <%= link_to "Passions",       root_path(anchor: "passions"),        data: { turbo: false }, class: "hover:text-sky-600 transition" %>
      <%= link_to "À propos",       root_path(anchor: "about"),           data: { turbo: false }, class: "hover:text-sky-600 transition" %>
      <%= link_to "Contact",        root_path(anchor: "contact"),         data: { turbo: false }, class: "hover:text-sky-600 transition" %>
    </nav>
  </div>

  <!-- Nav mobile (panneau déroulant) -->
  <div id="mobileMenu" class="md:hidden hidden border-t border-slate-200">
    <nav class="max-w-6xl mx-auto px-4 sm:px-6 py-3 grid gap-2 text-base font-semibold">
      <%= link_to "Projets",        root_path(anchor: "projects"),        data: { turbo: false }, class: "py-2 hover:text-sky-600 transition" %>
      <%= link_to "Certifications", root_path(anchor: "certifications"),  data: { turbo: false }, class: "py-2 hover:text-sky-600 transition" %>
      <%= link_to "Passions",       root_path(anchor: "passions"),        data: { turbo: false }, class: "py-2 hover:text-sky-600 transition" %>
      <%= link_to "À propos",       root_path(anchor: "about"),           data: { turbo: false }, class: "py-2 hover:text-sky-600 transition" %>
      <%= link_to "Contact",        root_path(anchor: "contact"),         data: { turbo: false }, class: "py-2 hover:text-sky-600 transition" %>
      <%= link_to "Discuter",       root_path(anchor: "contact"),         data: { turbo: false },
            class: "mt-2 inline-flex items-center justify-center rounded-xl bg-sky-500 px-4 py-2 text-white shadow hover:bg-sky-600 transition" %>
    </nav>
  </div>
  </header>

<!-- Toggle JS (respecte ta CSP avec nonce) -->
<script nonce="<%= content_security_policy_nonce %>">
  (() => {
    const btn = document.getElementById('menuBtn');
    const menu = document.getElementById('mobileMenu');
    if (!btn || !menu) return;
    btn.addEventListener('click', () => {
      const open = !menu.classList.toggle('hidden');
      btn.setAttribute('aria-expanded', String(open));
    });
  })();
</script>


  <%= yield %>

  <footer class="bg-white/90 backdrop-blur border-t border-slate-200">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 py-4
                flex flex-col gap-3
                md:flex-row md:items-center md:justify-between">

      <!-- Gauche : logo + nom -->
      <%= link_to root_path, class: "flex items-center gap-2 shrink-0" do %>
        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 256 256" aria-label="Logo SC">
          <path d="M128 24 L38 112 L128 232 L218 112 Z" fill="none" stroke="#0ea5e9" stroke-width="14" stroke-linecap="round" stroke-linejoin="round"/>
          <text x="128" y="150" text-anchor="middle" font-family="Inter, system-ui, -apple-system, 'Segoe UI', Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif" font-weight="800" font-size="110" letter-spacing="-6" fill="#0f172a">SC</text>
        </svg>
        <span class="font-semibold tracking-tight">Sami Chabane</span>
      <% end %>

      <!-- Milieu : liens de section -->
      <nav class="flex flex-wrap items-center justify-center gap-x-6 gap-y-2 text-sm md:text-base font-medium">
        <%= link_to "Projets",        root_path(anchor: "projects"),       data: { turbo: false }, class: "hover:text-sky-600 transition" %>
        <%= link_to "Certifications", root_path(anchor: "certifications"), data: { turbo: false }, class: "hover:text-sky-600 transition" %>
        <%= link_to "Passions",       root_path(anchor: "passions"),       data: { turbo: false }, class: "hover:text-sky-600 transition" %>
        <%= link_to "À propos",       root_path(anchor: "about"),          data: { turbo: false }, class: "hover:text-sky-600 transition" %>
        <%= link_to "Contact",        root_path(anchor: "contact"),        data: { turbo: false }, class: "hover:text-sky-600 transition" %>
      </nav>

      <!-- Droite : mention + réseaux -->
      <div class="flex items-center gap-4">
        <div class="group flex items-center gap-1 text-sm text-slate-500">
          <span>Fait avec</span>
          <span class="mx-1 inline-flex items-center justify-center text-red-500 animate-heart transition-transform will-change-transform group-hover:scale-125" aria-hidden="true">♥</span>
          <span>par</span>
          <%= link_to "Sami Chabane",
            "https://www.linkedin.com/in/sami-chabane-085881151/",
            target: "_blank", rel: "noopener",
            class: "font-medium text-sky-600 hover:underline" %>
        </div>

        <!-- Icônes -->
        <div class="flex items-center gap-3 text-slate-500">
          <%= link_to "https://github.com/Samsam69004", target: "_blank", rel: "noopener",
              class: "hover:text-sky-600 transition", aria: { label: "GitHub" } do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 .5A12 12 0 0 0 0 12.6c0 5.3 3.4 9.7 8.2 11.3.6.1.8-.3.8-.6v-2c-3.3.7-4-1.5-4-1.5-.6-1.4-1.5-1.8-1.5-1.8-1.2-.8.1-.8.1-.8 1.3.1 2 .9 2 .9 1.1 1.9 2.9 1.3 3.5 1 .1-.8.4-1.3.7-1.6-2.6-.3-5.3-1.4-5.3-6a4.7 4.7 0 0 1 1.2-3.3 4.4 4.4 0 0 1 .1-3.2s1-.3 3.3 1.2a11.3 11.3 0 0 1 6 0c2.3-1.5 3.3-1.2 3.3-1.2.3.8.4 2.2.1 3.2a4.7 4.7 0 0 1 1.2 3.3c0 4.6-2.7 5.6-5.3 6 .4.3.8 1 .8 2.1v3.1c0 .3.2.7.8.6A12.1 12.1 0 0 0 24 12.6 12 12 0 0 0 12 .5z"/>
            </svg>
          <% end %>
          <%= link_to "https://www.linkedin.com/in/sami-chabane-085881151/", target: "_blank", rel: "noopener",
              class: "hover:text-sky-600 transition", aria: { label: "LinkedIn" } do %>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M4.98 3.5a2.5 2.5 0 1 0 0 5.001 2.5 2.5 0 0 0 0-5zM3 9h4v12H3zM9 9h3.8v1.9h.1a4.1 4.1 0 0 1 3.7-2.1c4 0 4.7 2.6 4.7 6v6H17V16c0-1.4 0-3.3-2-3.3s-2.3 1.5-2.3 3.2V21H9z"/>
            </svg>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Animation du cœur (inline CSS autorisé via nonce) -->
    <style nonce="<%= content_security_policy_nonce %>">
      @keyframes heartbeat {
        0%, 40%, 80%, 100% { transform: scale(1) }
        20%, 60% { transform: scale(1.22) }
      }
      .animate-heart {
        display: inline-block;
        animation: heartbeat 1.6s ease-in-out infinite;
        transition: transform .2s ease;
      }
    </style>
  </footer>
</body>
</html>
